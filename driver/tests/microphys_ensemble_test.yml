# This input file defines an ensemble test for our microphysics driver.
# It performs a test of MAM4 (with marine organics and coarse-mode
# carbonaceous species) that exercises modal_aero_calcsize,
# modal_aero_wateruptake, and modal_aero_amicphys (all the amicphys processes),
# with cloud fraction = 0.
#
# There is no benchmark solution for this test case.

# Simulation control parameters.
parameters:
  mdo_calcsize:   1
  mdo_gaschem:    0
  mdo_cloudchem:  0
  mdo_gasaerexch: 1
  mdo_rename:     1
  mdo_newnuc:     1
  mdo_coag:       1
  num_unit:       1
  frac_unit:      0
  gas_unit:       0

# "MET" input. Needs a better name.
met_input:
  temp:     239.25 # air temperature [K]
  press:    3.0e4  # pressure [Pa]
  RH_CLEA:  0.5    # clear-sky RH [?]
  hgt: 7500        # height above Earth's surface [m]
  cld_frac: 0      # cloud fraction [-]

# Defining several values for any initial condition causes the driver to be
# run in "ensemble mode", in which it runs an ensemble of simulations whose
# initial conditions are the outer product of the defined set.
initial_conditions:
  # Accumulation mode [mass fraction]
  mfso41: 0.3
  mfpom1: 0
  mfsoa1: 0.3
  mfbc1:  0
  mfdst1: 0
  mfncl1: 0.4
  # Aitkin mode [mass fraction]
  mfso42: 0.3
  mfsoa2: 0.3
  mfncl2: 0.4
  # Coarse mode [mass fraction]
  mfdst3: 0
  mfncl3: 0.4
  mfso43: 0
  mfbc3:  0
  # Primary carbon mode [mass fraction]
  mfpom4: 0.9
  mfbc4:  0.1
  # Gases [kmol gas/kmol air]
  h2so4: [0.45e-10, 0.55e-10, 0.65e-10, 0.75e-10]
  soag:  [0.15e-9, 0.25e-9, 0.35e-9, 0.45e-9]
  # Modal number densities [#/kg]
  numc1: [1.0e8, 1.2e8]
  numc2: [1.0e9, 1.2e9]
  numc3: [1.0e5, 1.5e5]
  numc4: [5.0e8, 7.0e8]

  num_factor: 1
  gas_factor: 1

  # Constant gas chemistry production rate [mol gas / mol air]
  h2so4_chem_prod_rate: 1.0e-16

# Perturbation, if included, can be a number of a map of prognostic variable
# names to their perturbations. If a number, it's applied to all initial
# conditions with the given factor multiplied by "machine epsilon". Otherwise,
# it's applied only to the specified initial conditions (again, as a multiple
# of machine epsilon). Only one value of perturbation may be applied to each
# variable in an initial condition.
perturbation: 0

# Timestep [s]
# If the timestep is a sequence of values, the driver runs an ensemble of
# simulations consisting of runs adopting each of the specified values.
timestep: [1, 10, 60, 300, 1800]

# Simulation duration [s]
# At the moment, this must be a multiple of the timestep.
duration: 3600

# Output options
# In "regular mode", one output file is generated with the given prefix
# ("microphys_ensemble.nc", in this case).
# In "ensemble mode", one output file per ensemble member is generated, numbered
# from 1 to N, where N is the size of the ensemble. In this case, a set of
# 256 files ("microphys_ensemble_1.nc", "microphys_ensemble_2.nc", ...) is
# generated.
output:
  directory: .               # directory in which to generate output files
  prefix: microphys_ensemble # prefix for each output file
